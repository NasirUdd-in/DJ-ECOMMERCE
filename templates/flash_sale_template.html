{% extends 'base.html' %}
{% load static %}

{% block title %}Flash Sale{% endblock title %}

{% block links %}
<style>
    #flash-sale-timer {
        font-family: 'Arial', sans-serif;
        font-size: 26px;
        color: #fff; /* Set text color to white for better visibility on a red background */
        text-align: center;
        margin: 37px 10px;
        background-color: #e74c3c; /* Reddish background color */
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: inline-block;
    }

    .timer-box {
        display: inline-block;
        padding: 10px;
        border: 2px solid #007BFF;
        border-radius: 5px;
        margin-top: 10px;
        background-color: #f8f9fa;
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
        font-weight: bold;
        letter-spacing: 1px;
    }

    .timer-box span {
        display: inline-block;
        padding: 5px;
        margin: 0 2px;
        background-color: #007BFF;
        color: #fff;
        border-radius: 3px;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }

        100% {
            transform: scale(1);
        }
    }

    .timer-box span {
        animation: pulse 1s infinite;
    }
  .swiper {
    width: 100%;
    height: 100%;
  }

  .swiper-slide {
    text-align: center;
    font-size: 18px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  @media (max-width: 760px) {
    .swiper-button-next {
      right: 20px;
      transform: rotate(90deg);
    }

    .swiper-button-prev {
      left: 20px;
      transform: rotate(90deg);
    }
  }
</style>
{% endblock links %}

{% block content %}

        <div class="p-5">
  {% if show_flash_sale_details %}
  <div class="p-5">
    <h2>Flash Sale</h2>
</div>
    <div id="flash-sale-timer"></div>

    <!-- Swiper -->
    <div class="swiper">
      <div class="swiper-wrapper">
        {% for item in flash_sale_data %}
          <div class="swiper-slide">
            <div class="card" style="width: 20rem; ,height: 18rem;">
              <img class="card-img-top" style="height: 18rem;" src="{{item.product_thumbnail}}" alt="Card image cap">
              <div class="card-body">
                <p class="card-text">{{ item.product_name|truncatechars:20 }}</p>
                <p>Discount: {{ item.discount }}</p>
                <p>Original Price: {{ item.regular_price }}</p>
                <p>Updated Price: {{ item.updated_price }}</p>
                <form action="{% url 'add-to-cart' item.product_id %}" method="POST">
                  {% csrf_token %}
                  <button style="cursor: pointer;" type="submit" class="btn btn-outline-success">
                    Add to cart
                  </button>
                </form>
                {% comment %} <a href="#" class="btn btn-primary">Go somewhere</a> {% endcomment %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
</div>

  {% endif %}
{% endblock content %}

{% block extra_scripts %}
<!-- Include jQuery (you can replace it with a different library if needed) -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    // Function to update the timer
    function updateFlashSaleTimer(startDate, endDate) {
        var now = new Date();
        var startTime = new Date(startDate);
        var endTime = new Date(endDate);

        // Check if the sale has not started yet
        if (now < startTime) {
            var timeDiff = startTime - now;
            var days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            var hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            // Update the timer element
            $('#flash-sale-timer').html(
                'Sale Starts In: ' + days + 'd ' + hours + 'h ' + minutes + 'm ' + seconds + 's'
            );
        } else {
            // Calculate the time difference in milliseconds
            var timeDiff = endTime - now;

            // Check if the sale has ended
            if (timeDiff <= 0) {
                $('#flash-sale-timer').html('Sale has ended');
                return;
            }

            // Calculate the remaining time
            var days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            var hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            // Update the timer element
            $('#flash-sale-timer').html(
                'Time Left: ' + days + 'd ' + hours + 'h ' + minutes + 'm ' + seconds + 's'
            );
        }

        // Update the timer every second
        setTimeout(function () {
            updateFlashSaleTimer(startDate, endDate);
        }, 1000);
    }

    // Call the function with the start and end dates of the flash sale
    var startDate = '{{ flash_sale_data.0.active_date }}'; // Replace with the actual variable
    var endDate = '{{ flash_sale_data.0.expiry_date }}'; // Replace with the actual variable
    updateFlashSaleTimer(startDate, endDate);
</script>
  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!-- Initialize Swiper -->
  <script>
    var swiper = new Swiper('.swiper', {
      slidesPerView: 4,
      direction: getDirection(),
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      on: {
        resize: function () {
          swiper.changeDirection(getDirection());
        },
      },
    });

    function getDirection() {
      var windowWidth = window.innerWidth;
      var direction = window.innerWidth <= 760 ? 'vertical' : 'horizontal';

      return direction;
    }
  </script>
{% endblock extra_scripts %}
